<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Organizer Dashboard</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-sublabel {
            font-size: 12px;
            color: #999;
            margin-top: 4px;
        }

        .tabs {
            background: white;
            border-radius: 12px 12px 0 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            gap: 0;
            margin-bottom: 0;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
        }

        .tab:hover {
            background: #f8f9fa;
        }

        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
        }

        .tab-content {
            background: white;
            border-radius: 0 0 12px 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            min-height: 500px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .duplicate-group {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .duplicate-group:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .group-info {
            flex: 1;
        }

        .group-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .group-stats {
            font-size: 13px;
            color: #666;
        }

        .savings-badge {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 16px;
        }

        .file-list {
            margin: 15px 0;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: white;
            border-radius: 6px;
            border-left: 4px solid transparent;
        }

        .file-item.keep {
            border-left-color: #43e97b;
            background: #f0fff4;
        }

        .file-item.delete {
            border-left-color: #f5576c;
            background: #fff5f5;
        }

        .file-icon {
            font-size: 24px;
            margin-right: 12px;
        }

        .file-details {
            flex: 1;
        }

        .file-path {
            font-size: 13px;
            color: #333;
            word-break: break-all;
            font-family: 'Courier New', monospace;
        }

        .file-meta {
            font-size: 11px;
            color: #999;
            margin-top: 4px;
        }

        .file-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .badge-keep {
            background: #43e97b;
            color: white;
        }

        .badge-delete {
            background: #f5576c;
            color: white;
        }

        .group-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-success {
            background: #43e97b;
            color: white;
        }

        .btn-danger {
            background: #f5576c;
            color: white;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
        }

        .bulk-actions {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }

        .bulk-actions.active {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert-info {
            background: #e3f2fd;
            border-left-color: #2196f3;
            color: #1565c0;
        }

        .alert-success {
            background: #e8f5e9;
            border-left-color: #4caf50;
            color: #2e7d32;
        }

        .alert-warning {
            background: #fff3cd;
            border-left-color: #ffc107;
            color: #856404;
        }

        .alert-error {
            background: #ffebee;
            border-left-color: #f44336;
            color: #c62828;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>File Organizer Dashboard</h1>
            <p>Review and approve duplicate file deletions</p>
        </div>
    </div>

    <div class="container">
        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalFiles">-</div>
                <div class="stat-label">Total Files Scanned</div>
                <div class="stat-sublabel" id="totalSize">-</div>
            </div>

            <div class="stat-card">
                <div class="stat-value" id="duplicateGroups">-</div>
                <div class="stat-label">Duplicate Groups</div>
                <div class="stat-sublabel">Pending review</div>
            </div>

            <div class="stat-card">
                <div class="stat-value" id="potentialSavings">-</div>
                <div class="stat-label">Potential Savings</div>
                <div class="stat-sublabel" id="savingsPercent">-</div>
            </div>

            <div class="stat-card">
                <div class="stat-value" id="archiveSessions">-</div>
                <div class="stat-label">Archive Sessions</div>
                <div class="stat-sublabel">Active archives</div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" data-tab="duplicates">Duplicates</div>
            <div class="tab" data-tab="archives">Archives</div>
            <div class="tab" data-tab="reports">Reports</div>
        </div>

        <div class="tab-content">
            <!-- Duplicates Tab -->
            <div class="tab-pane active" id="duplicates-pane">
                <div id="duplicates-loading" class="loading">
                    <div class="spinner"></div>
                    <p>Loading duplicate groups...</p>
                </div>

                <div id="duplicates-content" style="display: none;">
                    <!-- Execution Panel -->
                    <div class="alert alert-warning" id="executionPanel" style="display: none; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px;">‚ö° Execute Operations</h3>
                        <div style="margin-bottom: 15px;">
                            <strong id="approvedCount">0</strong> groups approved for deletion
                            <span id="approvedSize" style="margin-left: 15px; color: #666;"></span>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="executeOperations(true)">
                                üîç Dry Run (Preview Only)
                            </button>
                            <button class="btn btn-danger" onclick="executeOperations(false)">
                                ‚ö†Ô∏è Execute (Archive Files)
                            </button>
                            <button class="btn btn-secondary" onclick="validateExecution()">
                                ‚úì Validate Operations
                            </button>
                        </div>
                        <div style="margin-top: 10px; font-size: 13px; color: #666;">
                            <strong>Dry Run:</strong> Validates and previews operations without making changes<br>
                            <strong>Execute:</strong> Archives approved duplicate files (recoverable for 30 days)
                        </div>
                    </div>

                    <div class="bulk-actions" id="bulkActions">
                        <div>
                            <strong id="selectedCount">0</strong> groups selected
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-success" onclick="bulkApprove()">Approve Selected</button>
                            <button class="btn btn-secondary" onclick="clearSelection()">Clear Selection</button>
                        </div>
                    </div>

                    <div id="duplicatesContainer"></div>

                    <div id="noDuplicates" class="empty-state" style="display: none;">
                        <div class="empty-state-icon">‚úì</div>
                        <h3>No Duplicates Found</h3>
                        <p>All duplicate groups have been processed or no duplicates detected.</p>
                    </div>
                </div>
            </div>

            <!-- Archives Tab -->
            <div class="tab-pane" id="archives-pane">
                <div class="alert alert-info">
                    <strong>Archive Management</strong><br>
                    Archives are retained for 30 days before permanent deletion. You can restore any archived files during this period.
                </div>

                <div id="archives-loading" class="loading">
                    <div class="spinner"></div>
                    <p>Loading archive sessions...</p>
                </div>

                <div id="archivesContainer"></div>
            </div>

            <!-- Reports Tab -->
            <div class="tab-pane" id="reports-pane">
                <div class="alert alert-info">
                    <strong>Reports & Statistics</strong><br>
                    Detailed reports and analytics coming soon in future updates.
                </div>

                <h3>Latest Scan Results</h3>
                <div id="scanResults"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:5001/api';
        let duplicateGroups = [];
        let selectedGroups = new Set();

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadSummary();
            loadDuplicates();
            setupTabs();
        });

        function setupTabs() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    switchTab(tabName);
                });
            });
        }

        function switchTab(tabName) {
            // Update tab active state
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Update pane active state
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
            document.getElementById(`${tabName}-pane`).classList.add('active');

            // Load tab data if needed
            if (tabName === 'archives') {
                loadArchives();
            } else if (tabName === 'reports') {
                loadScanResults();
            }
        }

        async function loadSummary() {
            try {
                const response = await fetch(`${API_BASE}/summary`);
                const data = await response.json();

                if (data.status === 'success') {
                    const stats = data.stats;
                    const scan = data.latest_scan;

                    // Update stats cards
                    document.getElementById('totalFiles').textContent = scan ? scan.total_files.toLocaleString() : '-';
                    document.getElementById('totalSize').textContent = scan ? `${(scan.total_size / (1024**3)).toFixed(2)} GB` : '-';
                    document.getElementById('duplicateGroups').textContent = stats.pending_duplicates.toLocaleString();
                    document.getElementById('potentialSavings').textContent = `${(stats.potential_savings_bytes / (1024**2)).toFixed(0)} MB`;

                    if (scan) {
                        const savingsPercent = (stats.potential_savings_bytes / scan.total_size * 100).toFixed(1);
                        document.getElementById('savingsPercent').textContent = `${savingsPercent}% of drive`;
                    }

                    document.getElementById('archiveSessions').textContent = stats.active_archives.toLocaleString();
                }
            } catch (error) {
                console.error('Error loading summary:', error);
            }
        }

        async function loadDuplicates() {
            try {
                const response = await fetch(`${API_BASE}/duplicates?limit=100`);
                const data = await response.json();

                document.getElementById('duplicates-loading').style.display = 'none';
                document.getElementById('duplicates-content').style.display = 'block';

                if (data.status === 'success' && data.groups.length > 0) {
                    duplicateGroups = data.groups;
                    renderDuplicates(data.groups);
                    updateExecutionPanel();
                } else {
                    document.getElementById('noDuplicates').style.display = 'block';
                    updateExecutionPanel();
                }
            } catch (error) {
                console.error('Error loading duplicates:', error);
                document.getElementById('duplicates-loading').innerHTML = `
                    <div class="alert alert-error">
                        Error loading duplicates: ${escapeHtml(error.message)}
                    </div>
                `;
            }
        }

        function renderDuplicates(groups) {
            const container = document.getElementById('duplicatesContainer');
            container.innerHTML = '';

            groups.forEach((group, index) => {
                const savings = (group.total_size * (group.file_count - 1)) / (1024**2);

                const groupEl = document.createElement('div');
                groupEl.className = 'duplicate-group';
                groupEl.innerHTML = `
                    <div class="group-header">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <input type="checkbox" class="checkbox" data-group-id="${group.id}"
                                   onchange="toggleGroupSelection(${group.id}, this.checked)">
                            <div class="group-info">
                                <div class="group-title">Duplicate Group #${index + 1}</div>
                                <div class="group-stats">
                                    ${group.file_count} identical copies ‚Ä¢ ${(group.total_size / (1024**2)).toFixed(1)} MB each
                                </div>
                            </div>
                        </div>
                        <div class="savings-badge">Save ${savings.toFixed(1)} MB</div>
                    </div>

                    <div class="file-list">
                        ${group.members.map(member => `
                            <div class="file-item ${member.keep ? 'keep' : 'delete'}">
                                <div class="file-icon">${member.keep ? '‚úì' : '√ó'}</div>
                                <div class="file-details">
                                    <div class="file-path">${escapeHtml(member.file_path)}</div>
                                    <div class="file-meta">
                                        ${(member.file_size / (1024**2)).toFixed(1)} MB ‚Ä¢ Modified: ${member.modified_date}
                                    </div>
                                </div>
                                <div class="file-badge ${member.keep ? 'badge-keep' : 'badge-delete'}">
                                    ${member.keep ? 'Keep' : 'Delete'}
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="group-actions">
                        <button class="btn btn-success" onclick="approveGroup(${group.id})">
                            Approve Deletion
                        </button>
                        <button class="btn btn-secondary" onclick="ignoreGroup(${group.id})">
                            Ignore
                        </button>
                    </div>
                `;

                container.appendChild(groupEl);
            });
        }

        function toggleGroupSelection(groupId, selected) {
            if (selected) {
                selectedGroups.add(groupId);
            } else {
                selectedGroups.delete(groupId);
            }

            updateBulkActions();
        }

        function updateBulkActions() {
            const count = selectedGroups.size;
            document.getElementById('selectedCount').textContent = count;

            const bulkActions = document.getElementById('bulkActions');
            if (count > 0) {
                bulkActions.classList.add('active');
            } else {
                bulkActions.classList.remove('active');
            }
        }

        function clearSelection() {
            selectedGroups.clear();
            document.querySelectorAll('.checkbox').forEach(cb => cb.checked = false);
            updateBulkActions();
        }

        async function approveGroup(groupId) {
            if (!confirm('Are you sure you want to approve this duplicate group for deletion?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/duplicates/${groupId}/approve`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();

                if (data.status === 'success') {
                    alert('Group approved! Files will be archived on next execution.');
                    loadDuplicates(); // Reload list
                    loadSummary(); // Update stats
                } else {
                    alert('Error approving group: ' + data.message);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function bulkApprove() {
            if (selectedGroups.size === 0) return;

            if (!confirm(`Approve ${selectedGroups.size} duplicate groups for deletion?`)) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/duplicates/bulk-approve`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        group_ids: Array.from(selectedGroups),
                        action: 'approve'
                    })
                });

                const data = await response.json();

                if (data.status === 'success') {
                    alert(`Success! Approved ${data.approved} groups, ${data.failed} failed.`);
                    clearSelection();
                    loadDuplicates();
                    loadSummary();
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function ignoreGroup(groupId) {
            alert('Ignore functionality coming soon!');
        }

        async function validateExecution() {
            try {
                const response = await fetch(`${API_BASE}/validate-execution`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ group_ids: null })  // null = all approved
                });

                const data = await response.json();

                if (data.status === 'success' && data.validation) {
                    const v = data.validation;
                    let message = `Validation Results:\n\n`;
                    message += `Valid: ${v.valid ? '‚úì Yes' : '‚úó No'}\n`;
                    message += `Files to process: ${v.file_count}\n`;
                    message += `Total size: ${v.total_size_mb} MB\n\n`;

                    if (v.errors.length > 0) {
                        message += `Errors:\n${v.errors.map(e => '  ‚Ä¢ ' + e).join('\n')}\n\n`;
                    }

                    if (v.warnings.length > 0) {
                        message += `Warnings:\n${v.warnings.map(w => '  ‚Ä¢ ' + w).join('\n')}\n`;
                    }

                    if (v.valid && v.errors.length === 0 && v.warnings.length === 0) {
                        message += `‚úì All checks passed! Safe to execute.`;
                    }

                    alert(message);
                } else {
                    alert('Validation failed: ' + data.message);
                }
            } catch (error) {
                alert('Error validating: ' + error.message);
            }
        }

        async function executeOperations(dryRun = true) {
            const actionText = dryRun ? 'DRY RUN' : 'EXECUTE';
            const confirmText = dryRun ?
                'Run dry-run simulation? This will validate operations without making any changes.' :
                '‚ö†Ô∏è WARNING ‚ö†Ô∏è\n\nThis will ARCHIVE approved duplicate files.\n\nFiles will be moved to the archive (recoverable for 30 days).\n\nContinue?';

            if (!confirm(confirmText)) {
                return;
            }

            try {
                // Show progress indicator
                const originalText = event.target.textContent;
                event.target.disabled = true;
                event.target.textContent = dryRun ? 'üîÑ Running dry-run...' : 'üîÑ Executing...';

                const response = await fetch(`${API_BASE}/execute`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        dry_run: dryRun,
                        group_ids: null  // null = all approved
                    })
                });

                const data = await response.json();
                event.target.disabled = false;
                event.target.textContent = originalText;

                if (data.status === 'success' && data.result) {
                    const r = data.result;
                    let message = `${dryRun ? 'DRY RUN' : 'EXECUTION'} COMPLETE\n\n`;
                    message += `‚úì Completed: ${r.operations_completed}\n`;
                    if (r.operations_failed > 0) {
                        message += `‚úó Failed: ${r.operations_failed}\n`;
                    }
                    message += `üì¶ Processed: ${r.total_size_mb} MB\n`;

                    if (!dryRun && r.operations_completed > 0) {
                        message += `\nüìÅ Archive Session: ${r.session_id}\n`;
                        message += `\n‚úì Files can be restored from Archives tab for 30 days.`;
                    }

                    if (r.warnings.length > 0) {
                        message += `\n\nWarnings:\n${r.warnings.map(w => '  ‚Ä¢ ' + w).join('\n')}`;
                    }

                    if (r.errors.length > 0) {
                        message += `\n\nErrors:\n${r.errors.map(e => '  ‚Ä¢ ' + e).join('\n')}`;
                    }

                    alert(message);

                    // Reload data
                    loadDuplicates();
                    loadSummary();

                    if (!dryRun) {
                        // Switch to archives tab to show the new session
                        setTimeout(() => {
                            if (confirm('View archived files in Archives tab?')) {
                                switchTab('archives');
                            }
                        }, 500);
                    }
                } else {
                    alert('Operation failed: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                event.target.disabled = false;
                event.target.textContent = originalText;
                alert('Error: ' + error.message);
            }
        }

        async function restoreArchive(sessionId) {
            if (!confirm(`Restore all files from archive session "${sessionId}"?\n\nThis will move archived files back to their original locations.`)) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/archives/${sessionId}/restore`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();

                if (data.status === 'success' && data.result) {
                    const r = data.result;
                    let message = `RESTORE COMPLETE\n\n`;
                    message += `‚úì Restored: ${r.restored} files\n`;
                    if (r.failed > 0) {
                        message += `‚úó Failed: ${r.failed} files\n`;
                    }

                    if (r.errors && r.errors.length > 0) {
                        message += `\nErrors:\n${r.errors.slice(0, 5).map(e => '  ‚Ä¢ ' + e).join('\n')}`;
                        if (r.errors.length > 5) {
                            message += `\n  ... and ${r.errors.length - 5} more errors`;
                        }
                    }

                    alert(message);

                    // Reload archives
                    loadArchives();
                } else {
                    alert('Restore failed: ' + (data.message || data.result?.error || 'Unknown error'));
                }
            } catch (error) {
                alert('Error restoring: ' + error.message);
            }
        }

        function updateExecutionPanel() {
            // Count approved groups
            const approvedCount = duplicateGroups.filter(g => g.status === 'approved').length;
            const approvedSize = duplicateGroups
                .filter(g => g.status === 'approved')
                .reduce((sum, g) => sum + (g.total_size * (g.file_count - 1)), 0);

            const panel = document.getElementById('executionPanel');
            const countElem = document.getElementById('approvedCount');
            const sizeElem = document.getElementById('approvedSize');

            if (approvedCount > 0) {
                panel.style.display = 'block';
                countElem.textContent = approvedCount;
                sizeElem.textContent = `(${(approvedSize / (1024 * 1024)).toFixed(1)} MB to archive)`;
            } else {
                panel.style.display = 'none';
            }
        }

        async function loadArchives() {
            document.getElementById('archives-loading').style.display = 'block';

            try {
                const response = await fetch(`${API_BASE}/archives`);
                const data = await response.json();

                const container = document.getElementById('archivesContainer');
                document.getElementById('archives-loading').style.display = 'none';

                if (data.status === 'success' && data.sessions.length > 0) {
                    container.innerHTML = data.sessions.map(session => {
                        const statusBadge = session.status === 'active' ?
                            '<span style="color: #28a745;">‚óè Active</span>' :
                            session.status === 'completed' ?
                            '<span style="color: #007bff;">‚úì Completed</span>' :
                            '<span style="color: #6c757d;">‚úó Deleted</span>';

                        const restoreButton = session.status === 'completed' ?
                            `<button class="btn btn-primary" onclick="restoreArchive('${escapeHtml(session.session_id)}')">‚Ü∫ Restore Files</button>` :
                            '';

                        return `
                        <div class="duplicate-group">
                            <div class="group-header">
                                <div class="group-info">
                                    <div class="group-title">${escapeHtml(session.session_id)}</div>
                                    <div class="group-stats">
                                        ${session.file_count} files ‚Ä¢ ${(session.total_size / (1024**2)).toFixed(1)} MB ‚Ä¢ ${statusBadge}
                                    </div>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    ${restoreButton}
                                </div>
                            </div>
                            <div class="file-path" style="margin: 10px 0; color: #666;">
                                üìÅ ${escapeHtml(session.archive_path)}
                            </div>
                            <div class="group-stats">
                                Created: ${escapeHtml(session.created_at)}
                                ${session.notes ? '<br>Notes: ' + escapeHtml(session.notes) : ''}
                            </div>
                        </div>
                    `}).join('');
                } else {
                    container.innerHTML = '<div class="empty-state"><h3>No Archive Sessions</h3><p>Archive sessions will appear here after executing file operations.</p></div>';
                }
            } catch (error) {
                console.error('Error loading archives:', error);
                document.getElementById('archives-loading').style.display = 'none';
                document.getElementById('archivesContainer').innerHTML =
                    '<div class="alert alert-danger">Error loading archives: ' + error.message + '</div>';
            }
        }

        async function loadScanResults() {
            try {
                const response = await fetch(`${API_BASE}/scan/status`);
                const data = await response.json();

                const container = document.getElementById('scanResults');

                if (data.status === 'success' && data.has_scan) {
                    const scan = data.scan;
                    container.innerHTML = `
                        <div class="duplicate-group">
                            <div class="group-stats">
                                Scan Date: ${scan.scan_date}<br>
                                Total Files: ${scan.total_files.toLocaleString()}<br>
                                Total Size: ${(scan.total_size / (1024**3)).toFixed(2)} GB<br>
                                Duplicate Groups: ${scan.duplicate_groups}<br>
                                Similar Groups: ${scan.similar_groups}<br>
                                Potential Savings: ${(scan.potential_savings / (1024**2)).toFixed(1)} MB<br>
                                Scan Duration: ${scan.scan_duration_seconds} seconds
                            </div>
                        </div>
                    `;
                } else {
                    container.innerHTML = '<div class="empty-state"><p>No scan results available</p></div>';
                }
            } catch (error) {
                console.error('Error loading scan results:', error);
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
